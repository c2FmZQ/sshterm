services:
  chrome:
    container_name: "headless-shell"
    image: "chromedp/headless-shell:141.0.7340.0"
    user: "65534:65534"
    shm_size: "2gb"
    command: [
      "--ignore-certificate-errors",
      "--enable-features=WebAuthentication,WebAuthnTestingAPI"
    ]
    healthcheck:
      test: ["CMD", "true"]
      interval: 5s
      retries: 5
      start_period: 5s

  devtest:
    container_name: "devtest"
    image: "sshterm-testserver"
    user: "65534:65534"
    command: "--with-chromedp=ws://chrome:9222"
    working_dir: "/"
    volumes:
      - type: tmpfs
        target: /tmp
        tmpfs:
          size: 100M
          mode: 0o777
    depends_on:
      chrome:
        condition: service_healthy

services:
  chrome:
    container_name: "headless-shell"
    image: "chromedp/headless-shell:141.0.7390.37"
    user: "65534:65534"
    shm_size: "2gb"
    command: [
      "--ignore-certificate-errors",
      "--disable-gpu",
      "--disable-dev-shm-usage",
    ]
    healthcheck:
      test: ["CMD", "true"]
      interval: 5s
      retries: 5
      start_period: 5s
    volumes:
      - type: tmpfs
        target: /nonexistent
        tmpfs:
          size: 10M
          mode: 0o777

  devtest:
    container_name: "devtest"
    hostname: "devtest.local"
    image: "sshterm-testserver"
    user: "65534:65534"
    command: [
      "--with-chromedp=ws://chrome:9222",
      "--test.v",
      "--test.failfast",
    ]
    working_dir: "/"
    volumes:
      - type: tmpfs
        target: /tmp
        tmpfs:
          size: 100M
          mode: 0o1777
    depends_on:
      chrome:
        condition: service_healthy
